\documentclass[../main-v1.tex]{subfiles}
\begin{document}
\chapter{Data formats}
\label{ch:format}

\section{Introduction} 

\dword{dune} has historically used the \dword{root} data format throughout the processing chain.  \dword{root} provides data objects and methods that have been optimized for \dword{hep} applications.  The \dword{larsoft} framework is \dword{root}-compatible and \dword{root} was used for the full processing chain for \dword{proto} Run 1. 

However, \dword{hep} increasingly uses   machine learning methods that rely on non-\dword{hep} data formats, notably the \dword{hdf5} format.  \dword{hdf5} is designed to save data as arrays of fundamental types, such as integers and floating-point numbers, along with metadata such as group names and dataset names.  \dword{root} files have much more structure.  \dword{root} provides mechanisms for saving and retrieving data in C++ classes, provides for automated conversion of data on readin when classes change from one version of user code to the next, and provides structures like trees. \dword{hdf5}'s uniformity of data representation has both advantages and disadvantages. For simple, repetitive data structures, such as the raw waveforms generated by \dword{dune}, the simplicity of \dword{hdf5} is useful.  For interaction reconstruction, \dword{root}'s features for processing complex data objects optimized for \dword{hep} are useful and convenient.  The current \dword{dune} processing chain uses both formats, and the choice has been optimized for each purpose.

In particular, the \dword{protoii} \dword{daq} system now writes raw data in \dword{hdf5} format. The utilization of \dword{hdf5} libraries within the \dword{daq} software allows for multiple processes to asynchronously write to the same output file. This ability is very advantageous when acquiring data from multiple FD modules or multiple ND detectors. The implementation of \dword{hdf5} is being tested within \dword{pdcoldbox} running at CERN with a small prototype of the \dword{pdvd} readout systems. 

The \dword{hdf5} format has been successfully integrated with the \dword{art} and \dword{larsoft} frameworks in a manner that allows improved memory management for large data records.  The  input \dword{hdf5} record is parsed and pointers to large data arrays are then made available, sequentially, to the \dword{art}/\dword{root} event processing framework for further processing. Development work to understand if streaming of \dword{hdf5} data over the network is possible or needed for efficient distributed processing of raw data files.

\end{document}